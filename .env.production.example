# Production Environment Configuration
# Industry-Standard Background Execution Architecture

# =============================================================================
# SERVICE MODE CONFIGURATION
# =============================================================================
SERVICE_MODE=api_only                  # api_only, background_worker, ai_worker, discovery_worker
ENVIRONMENT=production

# =============================================================================
# DATABASE CONFIGURATION (Supabase Pro)
# =============================================================================
DATABASE_URL=postgresql://user:password@host:5432/database
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key

# Database pool configuration (500 total connections)
DB_POOL_SIZE_USER_API=100              # User-facing API pool
DB_POOL_SIZE_BACKGROUND=80             # Background workers pool
DB_POOL_SIZE_AI=30                     # AI workers pool
DB_POOL_SIZE_DISCOVERY=20              # Discovery workers pool
DB_POOL_TIMEOUT=30                     # Connection timeout seconds
DB_STATEMENT_TIMEOUT_API=10000         # 10 seconds for API
DB_STATEMENT_TIMEOUT_WORKERS=300000    # 5 minutes for workers

# =============================================================================
# REDIS CONFIGURATION (Caching & Job Queues)
# =============================================================================
REDIS_URL=redis://localhost:6379/0
REDIS_PASSWORD=your-redis-password
CELERY_BROKER_URL=redis://localhost:6379/0
CELERY_RESULT_BACKEND=redis://localhost:6379/1

# Redis performance settings
REDIS_POOL_SIZE=20
REDIS_TIMEOUT=5
REDIS_MAXMEMORY=2gb
REDIS_MAXMEMORY_POLICY=allkeys-lru

# =============================================================================
# JOB QUEUE CONFIGURATION
# =============================================================================
# Queue depths and worker allocation
QUEUE_MAX_DEPTH_CRITICAL=50
QUEUE_MAX_DEPTH_HIGH=200
QUEUE_MAX_DEPTH_NORMAL=500
QUEUE_MAX_DEPTH_LOW=1000

# Worker concurrency
CELERY_WORKER_CONCURRENCY=4
CELERY_AI_WORKER_CONCURRENCY=2
CELERY_WORKER_PREFETCH_MULTIPLIER=1

# Tenant quotas
TENANT_QUOTA_FREE_CONCURRENT=2
TENANT_QUOTA_FREE_DAILY=50
TENANT_QUOTA_STANDARD_CONCURRENT=5
TENANT_QUOTA_STANDARD_DAILY=500
TENANT_QUOTA_PREMIUM_CONCURRENT=10
TENANT_QUOTA_PREMIUM_DAILY=2000
TENANT_QUOTA_ENTERPRISE_CONCURRENT=20
TENANT_QUOTA_ENTERPRISE_DAILY=unlimited

# =============================================================================
# AI PROCESSING CONFIGURATION
# =============================================================================
ENABLE_AI_ANALYSIS=true
AI_BATCH_SIZE=16
AI_MAX_WORKERS=2
AI_MODEL_CACHE_DIR=/app/models
AI_PROCESSING_TIMEOUT=600              # 10 minutes
AI_WORKER_MEMORY_LIMIT=8192            # 8GB

# AI Model Configuration
AI_SENTIMENT_MODEL=cardiffnlp/twitter-roberta-base-sentiment-latest
AI_LANGUAGE_MODEL=papluca/xlm-roberta-base-language-detection
AI_CONTENT_MODEL=facebook/bart-large-mnli

# =============================================================================
# MONITORING & OBSERVABILITY
# =============================================================================
ENABLE_PERFORMANCE_MONITORING=true
MONITORING_INTERVAL=30                 # seconds
METRICS_RETENTION_HOURS=24
ALERT_COOLDOWN_MINUTES=15

# Alert thresholds
ALERT_RESPONSE_TIME_WARNING=2000       # 2 seconds
ALERT_RESPONSE_TIME_CRITICAL=5000      # 5 seconds
ALERT_ERROR_RATE_WARNING=5             # 5%
ALERT_ERROR_RATE_CRITICAL=15           # 15%
ALERT_CPU_WARNING=70                   # 70%
ALERT_CPU_CRITICAL=90                  # 90%
ALERT_MEMORY_WARNING=80                # 80%
ALERT_MEMORY_CRITICAL=95               # 95%

# Monitoring endpoints
MONITORING_ALERT_WEBHOOK=https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK
PROMETHEUS_ENDPOINT=http://prometheus:9090
GRAFANA_ENDPOINT=http://grafana:3000

# =============================================================================
# EXTERNAL APIS
# =============================================================================
DECODO_API_KEY=your-decodo-api-key
SMARTPROXY_USERNAME=your-proxy-username
SMARTPROXY_PASSWORD=your-proxy-password

# API timeouts and retries
EXTERNAL_API_TIMEOUT=30
EXTERNAL_API_RETRIES=3
EXTERNAL_API_BACKOFF_FACTOR=2

# Rate limiting
RATE_LIMIT_REQUESTS_PER_MINUTE=1000
RATE_LIMIT_BURST_SIZE=100

# =============================================================================
# SECURITY CONFIGURATION
# =============================================================================
JWT_SECRET_KEY=your-super-secret-jwt-key
JWT_ALGORITHM=HS256
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=30

# CORS settings
ALLOWED_ORIGINS=https://analytics.following.ae,https://app.following.ae
CORS_ALLOW_CREDENTIALS=true

# Security headers
SECURITY_HEADERS_ENABLED=true
CSP_ENABLED=true

# =============================================================================
# CDN & MEDIA PROCESSING
# =============================================================================
CDN_ENABLED=true
CDN_BASE_URL=https://cdn.following.ae
CLOUDFLARE_ZONE_ID=your-cloudflare-zone-id
CLOUDFLARE_API_TOKEN=your-cloudflare-api-token

# Image processing
IMAGE_MAX_SIZE=10485760               # 10MB
IMAGE_ALLOWED_TYPES=jpg,jpeg,png,webp
IMAGE_QUALITY=85

# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================
LOG_LEVEL=INFO
LOG_FORMAT=json
LOG_FILE=/var/log/analytics/app.log

# Structured logging
ENABLE_STRUCTURED_LOGGING=true
LOG_REQUEST_ID=true
LOG_USER_ID=true

# =============================================================================
# HEALTH CHECKS
# =============================================================================
HEALTH_CHECK_INTERVAL=30
HEALTH_CHECK_TIMEOUT=10
HEALTH_CHECK_ENABLED=true

# Component health check endpoints
HEALTH_DB_ENABLED=true
HEALTH_REDIS_ENABLED=true
HEALTH_EXTERNAL_APIS_ENABLED=true

# =============================================================================
# PERFORMANCE OPTIMIZATION
# =============================================================================
# API performance
API_RESPONSE_TIME_TARGET=50           # milliseconds
API_CACHE_TTL_PROFILE=3600           # 1 hour
API_CACHE_TTL_POSTS=1800             # 30 minutes
API_CACHE_TTL_AI=86400               # 24 hours

# Worker performance
WORKER_HEARTBEAT_INTERVAL=30
WORKER_MAX_TASKS_PER_CHILD=100
WORKER_RESTART_MEMORY_THRESHOLD=2048  # 2GB

# =============================================================================
# BUSINESS LOGIC CONFIGURATION
# =============================================================================
# Credit system
PROFILE_ANALYSIS_COST=25
POST_ANALYSIS_COST=5
BULK_EXPORT_COST=50

# Free allowances (monthly)
FREE_PROFILE_UNLOCKS=5
FREE_POST_ANALYTICS=0
FREE_BULK_EXPORTS=1

# =============================================================================
# DEPLOYMENT CONFIGURATION
# =============================================================================
DEPLOYMENT_MODE=production
CONTAINER_REGISTRY=your-registry.com
BUILD_VERSION=latest

# Scaling configuration
MIN_API_REPLICAS=3
MAX_API_REPLICAS=10
MIN_WORKER_REPLICAS=2
MAX_WORKER_REPLICAS=8
MIN_AI_WORKER_REPLICAS=1
MAX_AI_WORKER_REPLICAS=3

# Resource limits
API_MEMORY_LIMIT=2Gi
API_CPU_LIMIT=1000m
WORKER_MEMORY_LIMIT=4Gi
WORKER_CPU_LIMIT=2000m
AI_WORKER_MEMORY_LIMIT=8Gi
AI_WORKER_CPU_LIMIT=4000m

# =============================================================================
# BACKUP & DISASTER RECOVERY
# =============================================================================
BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 2 * * *             # Daily at 2 AM
BACKUP_RETENTION_DAYS=30
BACKUP_S3_BUCKET=your-backup-bucket

# Disaster recovery
DR_ENABLED=true
DR_REGION=us-west-2
DR_RTO=4                              # hours
DR_RPO=1                              # hours